using SharpDX;
using SharpDX.Direct2D1;
using SharpDX.Direct3D;
using SharpDX.Mathematics.Interop;
using SharpDX.WIC;
using System;
using System.Collections.Generic;
using System.IO;
using System.Threading;
using System.Windows.Forms;

public sealed class InterfaceWindow : NativeWindow
{
	#region Win32 Constants
	private const int WM_SIZE = 0x0005;
	private const int WM_CLOSE = 0x0010;
	private const int WS_OVERLAPPEDWINDOW = 0x00CF0000;
	private const int WS_VISIBLE = 0x10000000;
	#endregion
	#region Private Variables
	private StateMachine _stateMachine;
	private ApplicationContext _applicationContext;
	private bool _creationMessageFlag = false;
	#endregion
	#region Public Constructors
	public InterfaceWindow(StateMachine stateMachine, ApplicationContext context)
	{
		_stateMachine = stateMachine;
		_applicationContext = context;

		CreateParams cp = new CreateParams
		{
			Caption = "Blank Window",
			Style = WS_OVERLAPPEDWINDOW | WS_VISIBLE,
			X = 100,
			Y = 100,
			Width = 480,
			Height = 270
		};

		_creationMessageFlag = true;
		CreateHandle(cp);
		_creationMessageFlag = false;
	}
	#endregion
	#region Protected Overrides
	protected override void WndProc(ref Message m)
	{
		if (m.Msg is WM_CLOSE)
		{
			_applicationContext.ExitThread();
		}
		else if (m.Msg is WM_SIZE)
		{
			_stateMachine.windowWidth = (int)m.LParam & 0xFFFF;
			_stateMachine.windowHeight = ((int)m.LParam >> 16) & 0xFFFF;
			if (!_creationMessageFlag)
			{
				_stateMachine.resizeRequested = true;
				while (!_stateMachine.resizeComplete)
				{

				}
				_stateMachine.resizeComplete = false;
			}
		}
		base.WndProc(ref m);
	}
	#endregion
	#region Debugging
	private static readonly int[] _win32MessageCodes = new int[] { 0, 1, 2, 3, 5, 6, 7, 8, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 38, 39, 40, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 55, 57, 61, 65, 68, 70, 71, 72, 73, 74, 75, 78, 80, 81, 82, 83, 84, 85, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 171, 172, 173, 176, 177, 178, 179, 180, 181, 182, 183, 185, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206, 207, 209, 209, 210, 211, 212, 213, 214, 215, 216, 217, 224, 225, 226, 227, 228, 230, 233, 234, 235, 240, 241, 242, 243, 244, 245, 246, 247, 248, 255, 256, 256, 257, 258, 259, 260, 261, 262, 263, 265, 265, 266, 267, 268, 269, 270, 271, 271, 272, 273, 274, 275, 276, 277, 278, 279, 280, 287, 288, 289, 290, 291, 292, 293, 294, 295, 296, 297, 305, 306, 307, 308, 309, 310, 311, 312, 320, 321, 322, 323, 324, 325, 326, 327, 328, 329, 330, 331, 332, 333, 334, 335, 336, 337, 338, 339, 340, 341, 342, 343, 344, 345, 346, 347, 348, 349, 350, 351, 352, 353, 355, 356, 357, 512, 512, 513, 514, 515, 516, 517, 518, 519, 520, 521, 521, 522, 523, 524, 525, 526, 528, 529, 530, 531, 532, 533, 534, 536, 537, 544, 545, 546, 547, 548, 549, 550, 551, 552, 553, 560, 561, 562, 563, 564, 640, 641, 642, 643, 644, 645, 646, 648, 656, 656, 657, 657, 672, 673, 674, 675, 768, 769, 770, 771, 772, 773, 774, 775, 776, 777, 778, 779, 780, 781, 782, 783, 784, 785, 786, 791, 792, 793, 856, 863, 864, 895, 896, 897, 898, 899, 899, 900, 901, 901, 902, 903, 904, 911, 1024, 1024, 1024, 1024, 1024, 1024, 1025, 1025, 1025, 1025, 1025, 1025, 1025, 1025, 1025, 1025, 1025, 1025, 1026, 1026, 1026, 1026, 1026, 1026, 1026, 1026, 1026, 1026, 1027, 1027, 1027, 1027, 1027, 1027, 1027, 1027, 1027, 1027, 1028, 1028, 1028, 1028, 1028, 1028, 1028, 1028, 1028, 1029, 1029, 1029, 1029, 1029, 1029, 1030, 1030, 1030, 1030, 1030, 1030, 1030, 1030, 1031, 1031, 1031, 1031, 1031, 1031, 1032, 1032, 1032, 1032, 1032, 1032, 1033, 1033, 1033, 1033, 1033, 1033, 1033, 1033, 1034, 1034, 1034, 1034, 1034, 1034, 1034, 1035, 1035, 1035, 1035, 1035, 1035, 1035, 1036, 1036, 1036, 1036, 1036, 1036, 1036, 1037, 1037, 1037, 1037, 1037, 1038, 1038, 1038, 1038, 1038, 1038, 1039, 1039, 1039, 1040, 1040, 1040, 1040, 1041, 1041, 1041, 1041, 1041, 1042, 1042, 1042, 1042, 1042, 1043, 1043, 1043, 1043, 1043, 1044, 1044, 1044, 1044, 1044, 1045, 1045, 1045, 1045, 1046, 1046, 1046, 1046, 1047, 1047, 1047, 1047, 1048, 1048, 1048, 1048, 1049, 1049, 1049, 1049, 1050, 1050, 1050, 1050, 1051, 1051, 1051, 1051, 1052, 1052, 1052, 1052, 1053, 1053, 1053, 1053, 1054, 1054, 1054, 1054, 1055, 1055, 1055, 1055, 1056, 1056, 1056, 1057, 1057, 1057, 1057, 1058, 1059, 1059, 1059, 1060, 1060, 1061, 1061, 1061, 1062, 1063, 1063, 1064, 1065, 1066, 1067, 1067, 1068, 1069, 1069, 1070, 1071, 1072, 1073, 1074, 1074, 1074, 1075, 1075, 1075, 1076, 1076, 1076, 1077, 1077, 1077, 1078, 1078, 1078, 1079, 1079, 1079, 1080, 1080, 1080, 1081, 1081, 1081, 1082, 1082, 1082, 1083, 1083, 1083, 1084, 1084, 1085, 1085, 1086, 1086, 1087, 1087, 1088, 1088, 1089, 1089, 1090, 1090, 1091, 1091, 1092, 1092, 1093, 1093, 1094, 1094, 1095, 1095, 1096, 1096, 1097, 1097, 1098, 1098, 1099, 1099, 1100, 1100, 1101, 1101, 1102, 1102, 1103, 1103, 1104, 1104, 1105, 1105, 1106, 1106, 1107, 1108, 1108, 1109, 1109, 1110, 1110, 1111, 1111, 1112, 1112, 1113, 1113, 1114, 1114, 1115, 1115, 1116, 1116, 1117, 1118, 1119, 1120, 1121, 1123, 1124, 1124, 1124, 1124, 1124, 1124, 1124, 1125, 1125, 1125, 1125, 1125, 1125, 1125, 1125, 1126, 1126, 1126, 1126, 1126, 1126, 1126, 1126, 1126, 1127, 1127, 1127, 1127, 1127, 1127, 1127, 1127, 1128, 1128, 1128, 1128, 1128, 1128, 1129, 1129, 1129, 1129, 1129, 1130, 1130, 1130, 1130, 1131, 1131, 1131, 1132, 1132, 1132, 1132, 1133, 1133, 1133, 1134, 1134, 1135, 1135, 1136, 1136, 1136, 1137, 1137, 1137, 1138, 1138, 1139, 1140, 1141, 1142, 1142, 1143, 1143, 1144, 1144, 1144, 1144, 1145, 1145, 1145, 1145, 1146, 1147, 1147, 1147, 1148, 1148, 1149, 1149, 1149, 1149, 1150, 1150, 1150, 1151, 1151, 1151, 1152, 1152, 1153, 1154, 1155, 1155, 1156, 1157, 1157, 1157, 1158, 1158, 1159, 1159, 1160, 1160, 1164, 1165, 1166, 1167, 1168, 1169, 1170, 1171, 1172, 1173, 1174, 1174, 1174, 1175, 1176, 1177, 1178, 1179, 1180, 1181, 1182, 1183, 1184, 1185, 1186, 1187, 1188, 1189, 1190, 1190, 1191, 1204, 1205, 1208, 1209, 1210, 1211, 1212, 1213, 1214, 1215, 1216, 1217, 1218, 1219, 1220, 1221, 1222, 1223, 1224, 1224, 1224, 1224, 1225, 1225, 1226, 1226, 1227, 1227, 1227, 1228, 1228, 1229, 1229, 1229, 1230, 1231, 1232, 1233, 1243, 1244, 1244, 1245, 1246, 1246, 1247, 1248, 1248, 1249, 1249, 1250, 1251, 1252, 1252, 1253, 1254, 1255, 1259, 1260, 1261, 1262, 1264, 1265, 1266, 1267, 1268, 1293, 1294, 1536, 1537, 1538, 1539, 1540, 1541, 1542, 1543, 1553, 1556, 1557, 1625, 2024, 2024, 2024, 2025, 2025, 2025, 2026, 2026, 2027, 2027, 2028, 2028, 2029, 2029, 2030, 2031, 2032, 4096, 4096, 4097, 4098, 4099, 4100, 4101, 4102, 4103, 4104, 4105, 4106, 4107, 4108, 4109, 4110, 4111, 4112, 4113, 4114, 4115, 4116, 4117, 4118, 4119, 4120, 4121, 4122, 4123, 4124, 4125, 4126, 4127, 4129, 4130, 4131, 4132, 4133, 4134, 4135, 4136, 4137, 4138, 4139, 4140, 4141, 4142, 4143, 4144, 4145, 4146, 4147, 4148, 4149, 4150, 4151, 4152, 4153, 4154, 4155, 4156, 4157, 4158, 4159, 4160, 4161, 4162, 4163, 4164, 4165, 4166, 4167, 4168, 4169, 4170, 4171, 4172, 4173, 4174, 4179, 4183, 4191, 4192, 4193, 4211, 4212, 4213, 4214, 4235, 4236, 4237, 4238, 4239, 4241, 4243, 4245, 4246, 4247, 4250, 4251, 4252, 4253, 4254, 4255, 4256, 4257, 4258, 4259, 4260, 4261, 4262, 4263, 4264, 4265, 4266, 4267, 4269, 4270, 4271, 4272, 4273, 4275, 4276, 4277, 4278, 4300, 4301, 4302, 4303, 4304, 4305, 4306, 4307, 8192, 8192, 8193, 8194, 8195, 8196, 8197, 8197, 8198, 8198, 8199, 8200, 8201, 8203, 8204, 8217, 8235, 8236, 8237, 8238, 8239, 8249, 8270, 8465, 8468, 8469, 8498, 8499, 8500, 8501, 8502, 8503, 8504, 8704, 8720, 32768, 52429 };
	private static readonly string[] _win32MessageTags = new string[] { "WM_NULL", "WM_CREATE", "WM_DESTROY", "WM_MOVE", "WM_SIZE", "WM_ACTIVATE", "WM_SETFOCUS", "WM_KILLFOCUS", "WM_ENABLE", "WM_SETREDRAW", "WM_SETTEXT", "WM_GETTEXT", "WM_GETTEXTLENGTH", "WM_PAINT", "WM_CLOSE", "WM_QUERYENDSESSION", "WM_QUIT", "WM_QUERYOPEN", "WM_ERASEBKGND", "WM_SYSCOLORCHANGE", "WM_ENDSESSION", "WM_SHOWWINDOW", "WM_CTLCOLOR", "WM_WININICHANGE", "WM_DEVMODECHANGE", "WM_ACTIVATEAPP", "WM_FONTCHANGE", "WM_TIMECHANGE", "WM_CANCELMODE", "WM_SETCURSOR", "WM_MOUSEACTIVATE", "WM_CHILDACTIVATE", "WM_QUEUESYNC", "WM_GETMINMAXINFO", "WM_PAINTICON", "WM_ICONERASEBKGND", "WM_NEXTDLGCTL", "WM_SPOOLERSTATUS", "WM_DRAWITEM", "WM_MEASUREITEM", "WM_DELETEITEM", "WM_VKEYTOITEM", "WM_CHARTOITEM", "WM_SETFONT", "WM_GETFONT", "WM_SETHOTKEY", "WM_GETHOTKEY", "WM_QUERYDRAGICON", "WM_COMPAREITEM", "WM_GETOBJECT", "WM_COMPACTING", "WM_COMMNOTIFY", "WM_WINDOWPOSCHANGING", "WM_WINDOWPOSCHANGED", "WM_POWER", "WM_COPYGLOBALDATA", "WM_COPYDATA", "WM_CANCELJOURNAL", "WM_NOTIFY", "WM_INPUTLANGCHANGEREQUEST", "WM_INPUTLANGCHANGE", "WM_TCARD", "WM_HELP", "WM_USERCHANGED", "WM_NOTIFYFORMAT", "WM_CONTEXTMENU", "WM_STYLECHANGING", "WM_STYLECHANGED", "WM_DISPLAYCHANGE", "WM_GETICON", "WM_SETICON", "WM_NCCREATE", "WM_NCDESTROY", "WM_NCCALCSIZE", "WM_NCHITTEST", "WM_NCPAINT", "WM_NCACTIVATE", "WM_GETDLGCODE", "WM_SYNCPAINT", "WM_NCMOUSEMOVE", "WM_NCLBUTTONDOWN", "WM_NCLBUTTONUP", "WM_NCLBUTTONDBLCLK", "WM_NCRBUTTONDOWN", "WM_NCRBUTTONUP", "WM_NCRBUTTONDBLCLK", "WM_NCMBUTTONDOWN", "WM_NCMBUTTONUP", "WM_NCMBUTTONDBLCLK", "WM_NCXBUTTONDOWN", "WM_NCXBUTTONUP", "WM_NCXBUTTONDBLCLK", "EM_GETSEL", "EM_SETSEL", "EM_GETRECT", "EM_SETRECT", "EM_SETRECTNP", "EM_SCROLL", "EM_LINESCROLL", "EM_SCROLLCARET", "EM_GETMODIFY", "EM_SETMODIFY", "EM_GETLINECOUNT", "EM_LINEINDEX", "EM_SETHANDLE", "EM_GETHANDLE", "EM_GETTHUMB", "EM_LINELENGTH", "EM_REPLACESEL", "EM_SETFONT", "EM_GETLINE", "EM_LIMITTEXT", "EM_SETLIMITTEXT", "EM_CANUNDO", "EM_UNDO", "EM_FMTLINES", "EM_LINEFROMCHAR", "EM_SETWORDBREAK", "EM_SETTABSTOPS", "EM_SETPASSWORDCHAR", "EM_EMPTYUNDOBUFFER", "EM_GETFIRSTVISIBLELINE", "EM_SETREADONLY", "EM_SETWORDBREAKPROC", "EM_GETWORDBREAKPROC", "EM_GETPASSWORDCHAR", "EM_SETMARGINS", "EM_GETMARGINS", "EM_GETLIMITTEXT", "EM_POSFROMCHAR", "EM_CHARFROMPOS", "EM_SETIMESTATUS", "EM_GETIMESTATUS", "SBM_SETPOS", "SBM_GETPOS", "SBM_SETRANGE", "SBM_GETRANGE", "SBM_ENABLE_ARROWS", "SBM_SETRANGEREDRAW", "SBM_SETSCROLLINFO", "SBM_GETSCROLLINFO", "SBM_GETSCROLLBARINFO", "BM_GETCHECK", "BM_SETCHECK", "BM_GETSTATE", "BM_SETSTATE", "BM_SETSTYLE", "BM_CLICK", "BM_GETIMAGE", "BM_SETIMAGE", "BM_SETDONTCLICK", "WM_INPUT", "WM_KEYDOWN", "WM_KEYFIRST", "WM_KEYUP", "WM_CHAR", "WM_DEADCHAR", "WM_SYSKEYDOWN", "WM_SYSKEYUP", "WM_SYSCHAR", "WM_SYSDEADCHAR", "WM_UNICHAR / WM_KEYLAST", "WM_WNT_CONVERTREQUESTEX", "WM_CONVERTREQUEST", "WM_CONVERTRESULT", "WM_INTERIM", "WM_IME_STARTCOMPOSITION", "WM_IME_ENDCOMPOSITION", "WM_IME_COMPOSITION", "WM_IME_KEYLAST", "WM_INITDIALOG", "WM_COMMAND", "WM_SYSCOMMAND", "WM_TIMER", "WM_HSCROLL", "WM_VSCROLL", "WM_INITMENU", "WM_INITMENUPOPUP", "WM_SYSTIMER", "WM_MENUSELECT", "WM_MENUCHAR", "WM_ENTERIDLE", "WM_MENURBUTTONUP", "WM_MENUDRAG", "WM_MENUGETOBJECT", "WM_UNINITMENUPOPUP", "WM_MENUCOMMAND", "WM_CHANGEUISTATE", "WM_UPDATEUISTATE", "WM_QUERYUISTATE", "WM_LBTRACKPOINT", "WM_CTLCOLORMSGBOX", "WM_CTLCOLOREDIT", "WM_CTLCOLORLISTBOX", "WM_CTLCOLORBTN", "WM_CTLCOLORDLG", "WM_CTLCOLORSCROLLBAR", "WM_CTLCOLORSTATIC", "CB_GETEDITSEL", "CB_LIMITTEXT", "CB_SETEDITSEL", "CB_ADDSTRING", "CB_DELETESTRING", "CB_DIR", "CB_GETCOUNT", "CB_GETCURSEL", "CB_GETLBTEXT", "CB_GETLBTEXTLEN", "CB_INSERTSTRING", "CB_RESETCONTENT", "CB_FINDSTRING", "CB_SELECTSTRING", "CB_SETCURSEL", "CB_SHOWDROPDOWN", "CB_GETITEMDATA", "CB_SETITEMDATA", "CB_GETDROPPEDCONTROLRECT", "CB_SETITEMHEIGHT", "CB_GETITEMHEIGHT", "CB_SETEXTENDEDUI", "CB_GETEXTENDEDUI", "CB_GETDROPPEDSTATE", "CB_FINDSTRINGEXACT", "CB_SETLOCALE", "CB_GETLOCALE", "CB_GETTOPINDEX", "CB_SETTOPINDEX", "CB_GETHORIZONTALEXTENT", "CB_SETHORIZONTALEXTENT", "CB_GETDROPPEDWIDTH", "CB_SETDROPPEDWIDTH", "CB_INITSTORAGE", "CB_MULTIPLEADDSTRING", "CB_GETCOMBOBOXINFO", "CB_MSGMAX", "WM_MOUSEFIRST", "WM_MOUSEMOVE", "WM_LBUTTONDOWN", "WM_LBUTTONUP", "WM_LBUTTONDBLCLK", "WM_RBUTTONDOWN", "WM_RBUTTONUP", "WM_RBUTTONDBLCLK", "WM_MBUTTONDOWN", "WM_MBUTTONUP", "WM_MBUTTONDBLCLK", "WM_MOUSELAST", "WM_MOUSEWHEEL", "WM_XBUTTONDOWN", "WM_XBUTTONUP", "WM_XBUTTONDBLCLK", "WM_MOUSEHWHEEL", "WM_PARENTNOTIFY", "WM_ENTERMENULOOP", "WM_EXITMENULOOP", "WM_NEXTMENU", "WM_SIZING", "WM_CAPTURECHANGED", "WM_MOVING", "WM_POWERBROADCAST", "WM_DEVICECHANGE", "WM_MDICREATE", "WM_MDIDESTROY", "WM_MDIACTIVATE", "WM_MDIRESTORE", "WM_MDINEXT", "WM_MDIMAXIMIZE", "WM_MDITILE", "WM_MDICASCADE", "WM_MDIICONARRANGE", "WM_MDIGETACTIVE", "WM_MDISETMENU", "WM_ENTERSIZEMOVE", "WM_EXITSIZEMOVE", "WM_DROPFILES", "WM_MDIREFRESHMENU", "WM_IME_REPORT", "WM_IME_SETCONTEXT", "WM_IME_NOTIFY", "WM_IME_CONTROL", "WM_IME_COMPOSITIONFULL", "WM_IME_SELECT", "WM_IME_CHAR", "WM_IME_REQUEST", "WM_IMEKEYDOWN", "WM_IME_KEYDOWN", "WM_IMEKEYUP", "WM_IME_KEYUP", "WM_NCMOUSEHOVER", "WM_MOUSEHOVER", "WM_NCMOUSELEAVE", "WM_MOUSELEAVE", "WM_CUT", "WM_COPY", "WM_PASTE", "WM_CLEAR", "WM_UNDO", "WM_RENDERFORMAT", "WM_RENDERALLFORMATS", "WM_DESTROYCLIPBOARD", "WM_DRAWCLIPBOARD", "WM_PAINTCLIPBOARD", "WM_VSCROLLCLIPBOARD", "WM_SIZECLIPBOARD", "WM_ASKCBFORMATNAME", "WM_CHANGECBCHAIN", "WM_HSCROLLCLIPBOARD", "WM_QUERYNEWPALETTE", "WM_PALETTEISCHANGING", "WM_PALETTECHANGED", "WM_HOTKEY", "WM_PRINT", "WM_PRINTCLIENT", "WM_APPCOMMAND", "WM_HANDHELDFIRST", "WM_HANDHELDLAST", "WM_AFXFIRST", "WM_AFXLAST", "WM_PENWINFIRST", "WM_RCRESULT", "WM_HOOKRCRESULT", "WM_GLOBALRCCHANGE", "WM_PENMISCINFO", "WM_SKB", "WM_HEDITCTL", "WM_PENCTL", "WM_PENMISC", "WM_CTLINIT", "WM_PENEVENT", "WM_PENWINLAST", "DDM_SETFMT", "DM_GETDEFID", "NIN_SELECT", "TBM_GETPOS", "WM_PSD_PAGESETUPDLG", "WM_USER", "CBEM_INSERTITEMA", "DDM_DRAW", "DM_SETDEFID", "HKM_SETHOTKEY", "PBM_SETRANGE", "RB_INSERTBANDA", "SB_SETTEXTA", "TB_ENABLEBUTTON", "TBM_GETRANGEMIN", "TTM_ACTIVATE", "WM_CHOOSEFONT_GETLOGFONT", "WM_PSD_FULLPAGERECT", "CBEM_SETIMAGELIST", "DDM_CLOSE", "DM_REPOSITION", "HKM_GETHOTKEY", "PBM_SETPOS", "RB_DELETEBAND", "SB_GETTEXTA", "TB_CHECKBUTTON", "TBM_GETRANGEMAX", "WM_PSD_MINMARGINRECT", "CBEM_GETIMAGELIST", "DDM_BEGIN", "HKM_SETRULES", "PBM_DELTAPOS", "RB_GETBARINFO", "SB_GETTEXTLENGTHA", "TBM_GETTIC", "TB_PRESSBUTTON", "TTM_SETDELAYTIME", "WM_PSD_MARGINRECT", "CBEM_GETITEMA", "DDM_END", "PBM_SETSTEP", "RB_SETBARINFO", "SB_SETPARTS", "TB_HIDEBUTTON", "TBM_SETTIC", "TTM_ADDTOOLA", "WM_PSD_GREEKTEXTRECT", "CBEM_SETITEMA", "PBM_STEPIT", "TB_INDETERMINATE", "TBM_SETPOS", "TTM_DELTOOLA", "WM_PSD_ENVSTAMPRECT", "CBEM_GETCOMBOCONTROL", "PBM_SETRANGE32", "RB_SETBANDINFOA", "SB_GETPARTS", "TB_MARKBUTTON", "TBM_SETRANGE", "TTM_NEWTOOLRECTA", "WM_PSD_YAFULLPAGERECT", "CBEM_GETEDITCONTROL", "PBM_GETRANGE", "RB_SETPARENT", "SB_GETBORDERS", "TBM_SETRANGEMIN", "TTM_RELAYEVENT", "CBEM_SETEXSTYLE", "PBM_GETPOS", "RB_HITTEST", "SB_SETMINHEIGHT", "TBM_SETRANGEMAX", "TTM_GETTOOLINFOA", "CBEM_GETEXSTYLE", "CBEM_GETEXTENDEDSTYLE", "PBM_SETBARCOLOR", "RB_GETRECT", "SB_SIMPLE", "TB_ISBUTTONENABLED", "TBM_CLEARTICS", "TTM_SETTOOLINFOA", "CBEM_HASEDITCHANGED", "RB_INSERTBANDW", "SB_GETRECT", "TB_ISBUTTONCHECKED", "TBM_SETSEL", "TTM_HITTESTA", "WIZ_QUERYNUMPAGES", "CBEM_INSERTITEMW", "RB_SETBANDINFOW", "SB_SETTEXTW", "TB_ISBUTTONPRESSED", "TBM_SETSELSTART", "TTM_GETTEXTA", "WIZ_NEXT", "CBEM_SETITEMW", "RB_GETBANDCOUNT", "SB_GETTEXTLENGTHW", "TB_ISBUTTONHIDDEN", "TBM_SETSELEND", "TTM_UPDATETIPTEXTA", "WIZ_PREV", "CBEM_GETITEMW", "RB_GETROWCOUNT", "SB_GETTEXTW", "TB_ISBUTTONINDETERMINATE", "TTM_GETTOOLCOUNT", "CBEM_SETEXTENDEDSTYLE", "RB_GETROWHEIGHT", "SB_ISSIMPLE", "TB_ISBUTTONHIGHLIGHTED", "TBM_GETPTICS", "TTM_ENUMTOOLSA", "SB_SETICON", "TBM_GETTICPOS", "TTM_GETCURRENTTOOLA", "RB_IDTOINDEX", "SB_SETTIPTEXTA", "TBM_GETNUMTICS", "TTM_WINDOWFROMPOINT", "RB_GETTOOLTIPS", "SB_SETTIPTEXTW", "TBM_GETSELSTART", "TB_SETSTATE", "TTM_TRACKACTIVATE", "RB_SETTOOLTIPS", "SB_GETTIPTEXTA", "TB_GETSTATE", "TBM_GETSELEND", "TTM_TRACKPOSITION", "RB_SETBKCOLOR", "SB_GETTIPTEXTW", "TB_ADDBITMAP", "TBM_CLEARSEL", "TTM_SETTIPBKCOLOR", "RB_GETBKCOLOR", "SB_GETICON", "TB_ADDBUTTONSA", "TBM_SETTICFREQ", "TTM_SETTIPTEXTCOLOR", "RB_SETTEXTCOLOR", "TB_INSERTBUTTONA", "TBM_SETPAGESIZE", "TTM_GETDELAYTIME", "RB_GETTEXTCOLOR", "TB_DELETEBUTTON", "TBM_GETPAGESIZE", "TTM_GETTIPBKCOLOR", "RB_SIZETORECT", "TB_GETBUTTON", "TBM_SETLINESIZE", "TTM_GETTIPTEXTCOLOR", "RB_BEGINDRAG", "TB_BUTTONCOUNT", "TBM_GETLINESIZE", "TTM_SETMAXTIPWIDTH", "RB_ENDDRAG", "TB_COMMANDTOINDEX", "TBM_GETTHUMBRECT", "TTM_GETMAXTIPWIDTH", "RB_DRAGMOVE", "TBM_GETCHANNELRECT", "TB_SAVERESTOREA", "TTM_SETMARGIN", "RB_GETBARHEIGHT", "TB_CUSTOMIZE", "TBM_SETTHUMBLENGTH", "TTM_GETMARGIN", "RB_GETBANDINFOW", "TB_ADDSTRINGA", "TBM_GETTHUMBLENGTH", "TTM_POP", "RB_GETBANDINFOA", "TB_GETITEMRECT", "TBM_SETTOOLTIPS", "TTM_UPDATE", "RB_MINIMIZEBAND", "TB_BUTTONSTRUCTSIZE", "TBM_GETTOOLTIPS", "TTM_GETBUBBLESIZE", "RB_MAXIMIZEBAND", "TBM_SETTIPSIDE", "TB_SETBUTTONSIZE", "TTM_ADJUSTRECT", "TBM_SETBUDDY", "TB_SETBITMAPSIZE", "TTM_SETTITLEA", "MSG_FTS_JUMP_VA", "TB_AUTOSIZE", "TBM_GETBUDDY", "TTM_SETTITLEW", "RB_GETBANDBORDERS", "MSG_FTS_JUMP_QWORD", "RB_SHOWBAND", "TB_GETTOOLTIPS", "MSG_REINDEX_REQUEST", "TB_SETTOOLTIPS", "MSG_FTS_WHERE_IS_IT", "RB_SETPALETTE", "TB_SETPARENT", "RB_GETPALETTE", "RB_MOVEBAND", "TB_SETROWS", "TB_GETROWS", "TB_GETBITMAPFLAGS", "TB_SETCMDID", "RB_PUSHCHEVRON", "TB_CHANGEBITMAP", "TB_GETBITMAP", "MSG_GET_DEFFONT", "TB_GETBUTTONTEXTA", "TB_REPLACEBITMAP", "TB_SETINDENT", "TB_SETIMAGELIST", "TB_GETIMAGELIST", "TB_LOADIMAGES", "EM_CANPASTE", "TTM_ADDTOOLW", "EM_DISPLAYBAND", "TB_GETRECT", "TTM_DELTOOLW", "EM_EXGETSEL", "TB_SETHOTIMAGELIST", "TTM_NEWTOOLRECTW", "EM_EXLIMITTEXT", "TB_GETHOTIMAGELIST", "TTM_GETTOOLINFOW", "EM_EXLINEFROMCHAR", "TB_SETDISABLEDIMAGELIST", "TTM_SETTOOLINFOW", "EM_EXSETSEL", "TB_GETDISABLEDIMAGELIST", "TTM_HITTESTW", "EM_FINDTEXT", "TB_SETSTYLE", "TTM_GETTEXTW", "EM_FORMATRANGE", "TB_GETSTYLE", "TTM_UPDATETIPTEXTW", "EM_GETCHARFORMAT", "TB_GETBUTTONSIZE", "TTM_ENUMTOOLSW", "EM_GETEVENTMASK", "TB_SETBUTTONWIDTH", "TTM_GETCURRENTTOOLW", "EM_GETOLEINTERFACE", "TB_SETMAXTEXTROWS", "EM_GETPARAFORMAT", "TB_GETTEXTROWS", "EM_GETSELTEXT", "TB_GETOBJECT", "EM_HIDESELECTION", "TB_GETBUTTONINFOW", "EM_PASTESPECIAL", "TB_SETBUTTONINFOW", "EM_REQUESTRESIZE", "TB_GETBUTTONINFOA", "EM_SELECTIONTYPE", "TB_SETBUTTONINFOA", "EM_SETBKGNDCOLOR", "TB_INSERTBUTTONW", "EM_SETCHARFORMAT", "TB_ADDBUTTONSW", "EM_SETEVENTMASK", "TB_HITTEST", "EM_SETOLECALLBACK", "TB_SETDRAWTEXTFLAGS", "EM_SETPARAFORMAT", "TB_GETHOTITEM", "EM_SETTARGETDEVICE", "TB_SETHOTITEM", "EM_STREAMIN", "TB_SETANCHORHIGHLIGHT", "EM_STREAMOUT", "TB_GETANCHORHIGHLIGHT", "EM_GETTEXTRANGE", "TB_GETBUTTONTEXTW", "EM_FINDWORDBREAK", "TB_SAVERESTOREW", "EM_SETOPTIONS", "TB_ADDSTRINGW", "EM_GETOPTIONS", "TB_MAPACCELERATORA", "EM_FINDTEXTEX", "TB_GETINSERTMARK", "EM_GETWORDBREAKPROCEX", "TB_SETINSERTMARK", "EM_SETWORDBREAKPROCEX", "TB_INSERTMARKHITTEST", "EM_SETUNDOLIMIT", "TB_MOVEBUTTON", "TB_GETMAXSIZE", "EM_REDO", "TB_SETEXTENDEDSTYLE", "EM_CANREDO", "TB_GETEXTENDEDSTYLE", "EM_GETUNDONAME", "TB_GETPADDING", "EM_GETREDONAME", "TB_SETPADDING", "EM_STOPGROUPTYPING", "TB_SETINSERTMARKCOLOR", "EM_SETTEXTMODE", "TB_GETINSERTMARKCOLOR", "EM_GETTEXTMODE", "TB_MAPACCELERATORW", "EM_AUTOURLDETECT", "TB_GETSTRINGW", "EM_GETAUTOURLDETECT", "TB_GETSTRINGA", "EM_SETPALETTE", "EM_GETTEXTEX", "EM_GETTEXTLENGTHEX", "EM_SHOWSCROLLBAR", "EM_SETTEXTEX", "TAPI_REPLY", "ACM_OPENA", "BFFM_SETSTATUSTEXTA", "CDM_FIRST", "CDM_GETSPEC", "EM_SETPUNCTUATION", "IPM_CLEARADDRESS", "WM_CAP_UNICODE_START", "ACM_PLAY", "BFFM_ENABLEOK", "CDM_GETFILEPATH", "EM_GETPUNCTUATION", "IPM_SETADDRESS", "PSM_SETCURSEL", "UDM_SETRANGE", "WM_CHOOSEFONT_SETLOGFONT", "ACM_STOP", "BFFM_SETSELECTIONA", "CDM_GETFOLDERPATH", "EM_SETWORDWRAPMODE", "IPM_GETADDRESS", "PSM_REMOVEPAGE", "UDM_GETRANGE", "WM_CAP_SET_CALLBACK_ERRORW", "WM_CHOOSEFONT_SETFLAGS", "ACM_OPENW", "BFFM_SETSELECTIONW", "CDM_GETFOLDERIDLIST", "EM_GETWORDWRAPMODE", "IPM_SETRANGE", "PSM_ADDPAGE", "UDM_SETPOS", "WM_CAP_SET_CALLBACK_STATUSW", "BFFM_SETSTATUSTEXTW", "CDM_SETCONTROLTEXT", "EM_SETIMECOLOR", "IPM_SETFOCUS", "PSM_CHANGED", "UDM_GETPOS", "CDM_HIDECONTROL", "EM_GETIMECOLOR", "IPM_ISBLANK", "PSM_RESTARTWINDOWS", "UDM_SETBUDDY", "CDM_SETDEFEXT", "EM_SETIMEOPTIONS", "PSM_REBOOTSYSTEM", "UDM_GETBUDDY", "EM_GETIMEOPTIONS", "PSM_CANCELTOCLOSE", "UDM_SETACCEL", "EM_CONVPOSITION", "EM_CONVPOSITION", "PSM_QUERYSIBLINGS", "UDM_GETACCEL", "MCIWNDM_GETZOOM", "PSM_UNCHANGED", "UDM_SETBASE", "PSM_APPLY", "UDM_GETBASE", "PSM_SETTITLEA", "UDM_SETRANGE32", "PSM_SETWIZBUTTONS", "UDM_GETRANGE32", "WM_CAP_DRIVER_GET_NAMEW", "PSM_PRESSBUTTON", "UDM_SETPOS32", "WM_CAP_DRIVER_GET_VERSIONW", "PSM_SETCURSELID", "UDM_GETPOS32", "PSM_SETFINISHTEXTA", "PSM_GETTABCONTROL", "PSM_ISDIALOGMESSAGE", "MCIWNDM_REALIZE", "PSM_GETCURRENTPAGEHWND", "MCIWNDM_SETTIMEFORMATA", "PSM_INSERTPAGE", "EM_SETLANGOPTIONS", "MCIWNDM_GETTIMEFORMATA", "PSM_SETTITLEW", "WM_CAP_FILE_SET_CAPTURE_FILEW", "EM_GETLANGOPTIONS", "MCIWNDM_VALIDATEMEDIA", "PSM_SETFINISHTEXTW", "WM_CAP_FILE_GET_CAPTURE_FILEW", "EM_GETIMECOMPMODE", "EM_FINDTEXTW", "MCIWNDM_PLAYTO", "WM_CAP_FILE_SAVEASW", "EM_FINDTEXTEXW", "MCIWNDM_GETFILENAMEA", "EM_RECONVERSION", "MCIWNDM_GETDEVICEA", "PSM_SETHEADERTITLEA", "WM_CAP_FILE_SAVEDIBW", "EM_SETIMEMODEBIAS", "MCIWNDM_GETPALETTE", "PSM_SETHEADERTITLEW", "EM_GETIMEMODEBIAS", "MCIWNDM_SETPALETTE", "PSM_SETHEADERSUBTITLEA", "MCIWNDM_GETERRORA", "PSM_SETHEADERSUBTITLEW", "PSM_HWNDTOINDEX", "PSM_INDEXTOHWND", "MCIWNDM_SETINACTIVETIMER", "PSM_PAGETOINDEX", "PSM_INDEXTOPAGE", "DL_BEGINDRAG", "MCIWNDM_GETINACTIVETIMER", "PSM_IDTOINDEX", "DL_DRAGGING", "PSM_INDEXTOID", "DL_DROPPED", "PSM_GETRESULT", "DL_CANCELDRAG", "PSM_RECALCPAGESIZES", "MCIWNDM_GET_SOURCE", "MCIWNDM_PUT_SOURCE", "MCIWNDM_GET_DEST", "MCIWNDM_PUT_DEST", "MCIWNDM_CAN_PLAY", "MCIWNDM_CAN_WINDOW", "MCIWNDM_CAN_RECORD", "MCIWNDM_CAN_SAVE", "MCIWNDM_CAN_EJECT", "MCIWNDM_CAN_CONFIG", "IE_GETINK", "IE_MSGFIRST", "MCIWNDM_PALETTEKICK", "IE_SETINK", "IE_GETPENTIP", "IE_SETPENTIP", "IE_GETERASERTIP", "IE_SETERASERTIP", "IE_GETBKGND", "IE_SETBKGND", "IE_GETGRIDORIGIN", "IE_SETGRIDORIGIN", "IE_GETGRIDPEN", "IE_SETGRIDPEN", "IE_GETGRIDSIZE", "IE_SETGRIDSIZE", "IE_GETMODE", "IE_SETMODE", "IE_GETINKRECT", "WM_CAP_SET_MCI_DEVICEW", "WM_CAP_GET_MCI_DEVICEW", "WM_CAP_PAL_OPENW", "WM_CAP_PAL_SAVEW", "IE_GETAPPDATA", "IE_SETAPPDATA", "IE_GETDRAWOPTS", "IE_SETDRAWOPTS", "IE_GETFORMAT", "IE_SETFORMAT", "IE_GETINKINPUT", "IE_SETINKINPUT", "IE_GETNOTIFY", "IE_SETNOTIFY", "IE_GETRECOG", "IE_SETRECOG", "IE_GETSECURITY", "IE_SETSECURITY", "IE_GETSEL", "IE_SETSEL", "CDM_LAST", "EM_SETBIDIOPTIONS", "IE_DOCOMMAND", "MCIWNDM_NOTIFYMODE", "EM_GETBIDIOPTIONS", "IE_GETCOMMAND", "EM_SETTYPOGRAPHYOPTIONS", "IE_GETCOUNT", "EM_GETTYPOGRAPHYOPTIONS", "IE_GETGESTURE", "MCIWNDM_NOTIFYMEDIA", "EM_SETEDITSTYLE", "IE_GETMENU", "EM_GETEDITSTYLE", "IE_GETPAINTDC", "MCIWNDM_NOTIFYERROR", "IE_GETPDEVENT", "IE_GETSELCOUNT", "IE_GETSELITEMS", "IE_GETSTYLE", "MCIWNDM_SETTIMEFORMATW", "EM_OUTLINE", "MCIWNDM_GETTIMEFORMATW", "EM_GETSCROLLPOS", "EM_SETSCROLLPOS", "EM_SETSCROLLPOS", "EM_SETFONTSIZE", "EM_GETZOOM", "MCIWNDM_GETFILENAMEW", "EM_SETZOOM", "MCIWNDM_GETDEVICEW", "EM_GETVIEWKIND", "EM_SETVIEWKIND", "EM_GETPAGE", "MCIWNDM_GETERRORW", "EM_SETPAGE", "EM_GETHYPHENATEINFO", "EM_SETHYPHENATEINFO", "EM_GETPAGEROTATE", "EM_SETPAGEROTATE", "EM_GETCTFMODEBIAS", "EM_SETCTFMODEBIAS", "EM_GETCTFOPENSTATUS", "EM_SETCTFOPENSTATUS", "EM_GETIMECOMPTEXT", "EM_ISIME", "EM_GETIMEPROPERTY", "EM_GETQUERYRTFOBJ", "EM_SETQUERYRTFOBJ", "FM_GETFOCUS", "FM_GETDRIVEINFOA", "FM_GETSELCOUNT", "FM_GETSELCOUNTLFN", "FM_GETFILESELA", "FM_GETFILESELLFNA", "FM_REFRESH_WINDOWS", "FM_RELOAD_EXTENSIONS", "FM_GETDRIVEINFOW", "FM_GETFILESELW", "FM_GETFILESELLFNW", "WLX_WM_SAS", "SM_GETSELCOUNT", "UM_GETSELCOUNT", "WM_CPL_LAUNCH", "SM_GETSERVERSELA", "UM_GETUSERSELA", "WM_CPL_LAUNCHED", "SM_GETSERVERSELW", "UM_GETUSERSELW", "SM_GETCURFOCUSA", "UM_GETGROUPSELA", "SM_GETCURFOCUSW", "UM_GETGROUPSELW", "SM_GETOPTIONS", "UM_GETCURFOCUSA", "UM_GETCURFOCUSW", "UM_GETOPTIONS", "UM_GETOPTIONS2", "LVM_FIRST", "LVM_GETBKCOLOR", "LVM_SETBKCOLOR", "LVM_GETIMAGELIST", "LVM_SETIMAGELIST", "LVM_GETITEMCOUNT", "LVM_GETITEMA", "LVM_SETITEMA", "LVM_INSERTITEMA", "LVM_DELETEITEM", "LVM_DELETEALLITEMS", "LVM_GETCALLBACKMASK", "LVM_SETCALLBACKMASK", "LVM_GETNEXTITEM", "LVM_FINDITEMA", "LVM_GETITEMRECT", "LVM_SETITEMPOSITION", "LVM_GETITEMPOSITION", "LVM_GETSTRINGWIDTHA", "LVM_HITTEST", "LVM_ENSUREVISIBLE", "LVM_SCROLL", "LVM_REDRAWITEMS", "LVM_ARRANGE", "LVM_EDITLABELA", "LVM_GETEDITCONTROL", "LVM_GETCOLUMNA", "LVM_SETCOLUMNA", "LVM_INSERTCOLUMNA", "LVM_DELETECOLUMN", "LVM_GETCOLUMNWIDTH", "LVM_SETCOLUMNWIDTH", "LVM_GETHEADER", "LVM_CREATEDRAGIMAGE", "LVM_GETVIEWRECT", "LVM_GETTEXTCOLOR", "LVM_SETTEXTCOLOR", "LVM_GETTEXTBKCOLOR", "LVM_SETTEXTBKCOLOR", "LVM_GETTOPINDEX", "LVM_GETCOUNTPERPAGE", "LVM_GETORIGIN", "LVM_UPDATE", "LVM_SETITEMSTATE", "LVM_GETITEMSTATE", "LVM_GETITEMTEXTA", "LVM_SETITEMTEXTA", "LVM_SETITEMCOUNT", "LVM_SORTITEMS", "LVM_SETITEMPOSITION32", "LVM_GETSELECTEDCOUNT", "LVM_GETITEMSPACING", "LVM_GETISEARCHSTRINGA", "LVM_SETICONSPACING", "LVM_SETEXTENDEDLISTVIEWSTYLE", "LVM_GETEXTENDEDLISTVIEWSTYLE", "LVM_GETSUBITEMRECT", "LVM_SUBITEMHITTEST", "LVM_SETCOLUMNORDERARRAY", "LVM_GETCOLUMNORDERARRAY", "LVM_SETHOTITEM", "LVM_GETHOTITEM", "LVM_SETHOTCURSOR", "LVM_GETHOTCURSOR", "LVM_APPROXIMATEVIEWRECT", "LVM_SETWORKAREAS", "LVM_GETSELECTIONMARK", "LVM_SETSELECTIONMARK", "LVM_SETBKIMAGEA", "LVM_GETBKIMAGEA", "LVM_GETWORKAREAS", "LVM_SETHOVERTIME", "LVM_GETHOVERTIME", "LVM_GETNUMBEROFWORKAREAS", "LVM_SETTOOLTIPS", "LVM_GETITEMW", "LVM_SETITEMW", "LVM_INSERTITEMW", "LVM_GETTOOLTIPS", "LVM_FINDITEMW", "LVM_GETSTRINGWIDTHW", "LVM_GETCOLUMNW", "LVM_SETCOLUMNW", "LVM_INSERTCOLUMNW", "LVM_GETITEMTEXTW", "LVM_SETITEMTEXTW", "LVM_GETISEARCHSTRINGW", "LVM_EDITLABELW", "LVM_GETBKIMAGEW", "LVM_SETSELECTEDCOLUMN", "LVM_SETTILEWIDTH", "LVM_SETVIEW", "LVM_GETVIEW", "LVM_INSERTGROUP", "LVM_SETGROUPINFO", "LVM_GETGROUPINFO", "LVM_REMOVEGROUP", "LVM_MOVEGROUP", "LVM_MOVEITEMTOGROUP", "LVM_SETGROUPMETRICS", "LVM_GETGROUPMETRICS", "LVM_ENABLEGROUPVIEW", "LVM_SORTGROUPS", "LVM_INSERTGROUPSORTED", "LVM_REMOVEALLGROUPS", "LVM_HASGROUP", "LVM_SETTILEVIEWINFO", "LVM_GETTILEVIEWINFO", "LVM_SETTILEINFO", "LVM_GETTILEINFO", "LVM_SETINSERTMARK", "LVM_GETINSERTMARK", "LVM_INSERTMARKHITTEST", "LVM_GETINSERTMARKRECT", "LVM_SETINSERTMARKCOLOR", "LVM_GETINSERTMARKCOLOR", "LVM_SETINFOTIP", "LVM_GETSELECTEDCOLUMN", "LVM_ISGROUPVIEWENABLED", "LVM_GETOUTLINECOLOR", "LVM_SETOUTLINECOLOR", "LVM_CANCELEDITLABEL", "LVM_MAPINDEXTOID", "LVM_MAPIDTOINDEX", "LVM_ISITEMVISIBLE", "LVM_GETEMPTYTEXT", "LVM_GETFOOTERRECT", "LVM_GETFOOTERINFO", "LVM_GETFOOTERITEMRECT", "LVM_GETFOOTERITEM", "LVM_GETITEMINDEXRECT", "LVM_SETITEMINDEXSTATE", "LVM_GETNEXTITEMINDEX", "CCM_FIRST", "OCM__BASE", "CCM_SETBKCOLOR", "CCM_SETCOLORSCHEME", "CCM_GETCOLORSCHEME", "CCM_GETDROPTARGET", "CCM_SETUNICODEFORMAT", "LVM_SETUNICODEFORMAT", "CCM_GETUNICODEFORMAT", "LVM_GETUNICODEFORMAT", "CCM_SETVERSION", "CCM_GETVERSION", "CCM_SETNOTIFYWINDOW", "CCM_SETWINDOWTHEME", "CCM_DPISCALE", "OCM_CTLCOLOR", "OCM_DRAWITEM", "OCM_MEASUREITEM", "OCM_DELETEITEM", "OCM_VKEYTOITEM", "OCM_CHARTOITEM", "OCM_COMPAREITEM", "OCM_NOTIFY", "OCM_COMMAND", "OCM_HSCROLL", "OCM_VSCROLL", "OCM_CTLCOLORMSGBOX", "OCM_CTLCOLOREDIT", "OCM_CTLCOLORLISTBOX", "OCM_CTLCOLORBTN", "OCM_CTLCOLORDLG", "OCM_CTLCOLORSCROLLBAR", "OCM_CTLCOLORSTATIC", "OCM_PARENTNOTIFY", "OCM_PARENTNOTIFY", "WM_APP", "WM_RASDIALEVENT" };
	private static readonly int[] _ignoredWin32MessageCodes = new int[] { 32, 512, 132, 160 };
	public static void WriteWin32Message(Message m)
	{
		int messageCode = m.Msg;
		int length1 = _ignoredWin32MessageCodes.Length;
		for (int i = 0; i < length1; i++)
		{
			if (messageCode == _ignoredWin32MessageCodes[i])
			{
				return;
			}
		}

		int messageID = 0;
		int length2 = _win32MessageCodes.Length;
		for (int i = 0; i < length2; i++)
		{
			if (_win32MessageCodes[i] == messageCode)
			{
				messageID = i;
			}
		}
		Console.WriteLine($"Win32Message {_win32MessageTags[messageID]} {messageCode} {(int)m.LParam} {(int)m.WParam}");
	}
	#endregion
}
public sealed class BitmapRenderrer : IDisposable
{
	private Factory _factory2D;
	private WindowRenderTarget _renderTarget;
	private SharpDX.Direct2D1.Bitmap _bitmap;
	private RawRectangleF _bitmapRect;
	private RawColor4 _backgroundColor = new RawColor4(0, 1, 0, 1);
	private StateMachine _stateMachine;
	public BitmapRenderrer(StateMachine stateMachine, IntPtr targetHwnd, string imagePath)
	{
		_stateMachine = stateMachine;
		_factory2D = new Factory();
		RenderTargetProperties renderTargetProperties = new RenderTargetProperties(new SharpDX.Direct2D1.PixelFormat(SharpDX.DXGI.Format.Unknown, AlphaMode.Premultiplied));
		HwndRenderTargetProperties hwndRenderTargetProperties = new HwndRenderTargetProperties { Hwnd = targetHwnd, PixelSize = new Size2(480, 270), PresentOptions = PresentOptions.Immediately };
		_renderTarget = new WindowRenderTarget(_factory2D, renderTargetProperties, hwndRenderTargetProperties);
		_renderTarget.AntialiasMode = AntialiasMode.Aliased;
		_bitmap = LoadBitmapFromFile(imagePath);
		_bitmapRect = new RawRectangleF(0, 0, _bitmap.Size.Width, _bitmap.Size.Height);
		_stateMachine.renderrerInitialized = true;
	}
	private SharpDX.Direct2D1.Bitmap LoadBitmapFromFile(string imagePath)
	{
		ImagingFactory imagingFactory = new ImagingFactory();
		BitmapDecoder bitmapDecoder = new BitmapDecoder(imagingFactory, imagePath, DecodeOptions.CacheOnDemand);
		FormatConverter formatConverter = new FormatConverter(imagingFactory);
		formatConverter.Initialize(bitmapDecoder.GetFrame(0), SharpDX.WIC.PixelFormat.Format32bppPRGBA, BitmapDitherType.None, null, 0.0, BitmapPaletteType.Custom);
		SharpDX.Direct2D1.Bitmap output = SharpDX.Direct2D1.Bitmap.FromWicBitmap(_renderTarget, formatConverter);
		ThreadPool.QueueUserWorkItem((object state) =>
		{
			imagingFactory.Dispose();
			bitmapDecoder.Dispose();
			formatConverter.Dispose();
		}, null);
		return output;
	}
	public void RenderLoop()
	{
		System.Diagnostics.Stopwatch fpsTimer = System.Diagnostics.Stopwatch.StartNew();
		long timeStamp = 0;
		long count = 0;
		while (true)
		{
			_renderTarget.BeginDraw();

			_renderTarget.Clear(_backgroundColor);

			_renderTarget.DrawBitmap(_bitmap, _bitmapRect, 1.0f, SharpDX.Direct2D1.BitmapInterpolationMode.NearestNeighbor);

			_renderTarget.EndDraw();

			if (_stateMachine.resizeRequested)
			{
				_renderTarget.Resize(new Size2(_stateMachine.windowWidth, _stateMachine.windowHeight));
				_stateMachine.resizeRequested = false;
				_stateMachine.resizeComplete = true;
			}

			count++;
			if (count > 1000)
			{
				long current = fpsTimer.ElapsedTicks;
				long elapsed = current - timeStamp;
				long tpf = elapsed / count;
				long fps = (10000000 * count) / elapsed;
				Console.WriteLine($"{fps}FPS {tpf}TPF");

				count = 0;
				timeStamp = current;
			}
		}
	}
	public void Dispose()
	{
		_bitmap.Dispose();
		_renderTarget.Dispose();
		_factory2D.Dispose();
	}
}
public sealed class StateMachine
{
	public bool windowInitialized = false;
	public bool resizeComplete = false;
	public bool resizeRequested = false;
	public bool renderrerInitialized = false;
	public int windowWidth = 480;
	public int windowHeight = 270;
}
public static class Program
{
	public static void Main(string[] args)
	{
		//Set process execution priorety to the highest.
		System.Diagnostics.Process currentProcess = System.Diagnostics.Process.GetCurrentProcess();
		currentProcess.PriorityBoostEnabled = true;
		currentProcess.PriorityClass = System.Diagnostics.ProcessPriorityClass.High;
		//currentProcess.ProcessorAffinity = (IntPtr)1;

		//Initialize application context
		ApplicationContext applicationContext = new ApplicationContext();

		//Create renderrer state machine
		StateMachine stateMachine = new StateMachine();

		//Initialize interfaceWindow
		InterfaceWindow interfaceWindow = null;
		Thread interfaceThread = new Thread(() =>
		{
			interfaceWindow = new InterfaceWindow(stateMachine, applicationContext);

			stateMachine.windowInitialized = true;

			while (true)
			{
				Application.DoEvents();
			}
		});
		interfaceThread.Priority = ThreadPriority.Highest;
		interfaceThread.IsBackground = false;
		interfaceThread.Start();

		while (!stateMachine.windowInitialized)
		{

		}

		BitmapRenderrer bitmapRenderrer = new BitmapRenderrer(stateMachine, interfaceWindow.Handle, "sharpdx.png");

		bitmapRenderrer.RenderLoop();
	}
}